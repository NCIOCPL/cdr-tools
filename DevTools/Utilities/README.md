# CDR Developer Utilities

This directory contains tools which CDR developers can run without
needing to file a CBIIT ticket.

## Scripts for working with individual CDR documents

 * `AddCdrDoc.cmd` - create a new CDR document from a disk file
 * `GetCdrDoc.cmd` - fetch current working version of CDR document
 * `GetCdrDocVersion.cmd` - fetch numbered version of CDR document
 * `CheckoutCdrDoc.py` - fetch and lock CDR document
 * `UnlockCdrDoc.py` - release the lock for a CDR document
 * `ReplaceCdrDoc.py` - store changes to a CDR doc from file (unversioned)
 * `VersionCdrDoc.cmd` - store changes to a CDR doc in an unpublised version
 * `ReplaceCdrPubDoc.py` - store changes to a CDR doc in a published version
 * `getPubProcCGdoc.py` - fetch filtered document sent to Cancer.gov
 * `valCdrDoc.py` - run validation checks against a CDR document
 * `valDocVersion.py` - validate a specific version of a CDR document
 * `showcdrdoc.py` - show a CDR document's XML in a web browser
 * `showdoc.bat` - display a CDR document with indenting

## Scripts for managing CDR Filters

### `CreateNewFilter.py`

This script creates a new stub CDR filter on the production server under
a specified filter title. The CDR ID for the new document is used to
form the file name under which the filter document is written, so that
it can be stored in a predictable place in the version control system.

### `InstallFilter.py`

This script is used to create a new document on a non-production tier,
using the file generated by `CreateNewFilter.py` (see above).

### `ListFilters.py`

This script lists all of the CDR filters on the current tier, showing
the production tier's CDR ID and filter title for each one. Useful for
finding a filter whose title you know in a git working directory.

### `UpdateFilter.py`

This script stores changes to an existing filter on the current tier.
Needs to be modified so that the target tier can be specified on the
command line.

### `TestFilter.py`

This script allows a CDR filter to tested from the command line, handing
off the filtering work to the CDR server. Tracing instructions can be
optionally injected into the filter before requesting the transformation.

### `FilterCdrDoc.cmd`

Less ambitious version of the previous script, taking a filter title
and the CDR ID of the document to be filtered.

### `ModifyFilterTitle.py`

Since the filters are possibly (and usually) stored under different
CDR document IDs in the various tiers, the filter title is the glue
which uniquely identifies a given filter document across the tiers.
This makes changing the title of a CDR filter something which needs
to be done carefully. That's what this script does. _(Possible
enhancement: add option to have the change made on all tiers at once.)_

## Scripts for editing the CDR online help pages

 * `GetHelpDocForEditing.py` - fetch pretty-printed help page document
 * `UpdateHelpDoc.py` - locks help page doc and replaces it from disk file

## Scripts for extracting/replaying commands from the CDR command logs

 * `GetCdrCommands.py`
 * `RunCdrCommands.py`

# XML/XSLT tools

 * `ValidateDoc2DTD.py` - validate CDR document against a DTD file
 * `xdiffxml.bat` - normalize and compare to XML documents
 * `xmlwf.exe` - test whether an XML document is well-formed
 * `pretty-print.py` - uses lxml to format an XML document
 * `countNodes.py` - used for diagnosing overly-large imported documents
 * `indent.xml` - used by some of the tools in this group

## Low-level commands for testing CDR client-server interface

 * `ListCdrActions.cmd`
 * `ListCdrGroups.cmd`
 * `ListCdrUsers.cmd`
 * `DoCdrCmd.cmd`
 * `FileCmd.cmd`

## Tools used when refreshing the DEV tier from production
 * `PullDevData.py`
 * `PushDevData.py`
 * `CheckDevData.py`
 * `RemoveProdGroups.py`

## Bulk processing utilities
 * `RevalidateDocs.py`
 * `ReindexAllDoctypes.py`
 * `ReindexByDocType.py`
 * `ReindexModsByDocType.py`
 * `UpdateTitleByDocType.py`
 * `MakePubVersions.py`
 * `MakePublishableVersions.py`
 * `SaveUnversionedChanges.py`
 * `UnlockDocsForUser.py`

## Miscellaneous tools
 * `DiffSchemas.py` - compare schemas in file system with CDR repository
 * `DummyWebServer.cpp` - lightweight HTTP server for low-level testing
 * `FindBigStuff.py` - parse `du` output looking for big disk usage culprits
 * `UpdatePubControlDoc.py` - store modified publishing control document
 * `cdr_python_modules.py` - check modules imported by CDR Python scripts
 * `get-prod-scripts.py` - bulk fetching of PROD logs
 * `create-script-for-prod-files.py` - create scripts for `get-prod-scripts.py`
 * `find-ids.py` - report values for all cdr:id attributes in a CDR document
 * `find-in-zips.py` - `grep` for contents of `zip` files
 * `get-tasks.py` - serialize CDR scheduled tasks
 * `register-typelibs.py` - used when upgrading Python
 * `sort-by-date.py` - produce a date/time-sorted list of the files in a tree
 * `tier-settings.py` - fetch/compare settings of CDR server on different tiers
